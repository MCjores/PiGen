# Резервное копирование
Резервное копирование выполняется в два этапа с
использованием технологии файловой системы "BTRFS"
по созданию мгновенных снимков подтома, и утилиты
"btrbk" для копирования снимков на внешний носитель.

## Конфигурация "btrbk"
Создание снимков осуществляется утилитой "btrbk".
Раздел "btrfs" монтируется в директорию _"/mnt/btrfs"_.
Таким образом становится доступен подтом "@home" по
пути _"/mnt/btrfs/@home"_ и директория для снимков
"snapshots" по пути _"/mnt/btrfs/snapshots"_. Резервное
копирование снимков производится на внешний дисковый
накопитель с файловой системой "BTRFS" и меткой тома
"AMPL_BACKUP".

> [!WARNING]
> Носитель с файловой системой "BTRFS" и меткой тома
> "AMPL_BACKUP" должен быть подсоединён до включения
> системы. Если он подключён позднее, то необходимо
> перезагрузить систему, иначе функция резервного
> копирования не будет работать!

Конфигурация резервного копирования:

- Минимальный срок хранения снимков: **2 дня**
- Срок хранения снимков: **14 дней**
- Срок хранения ежедневных резервных копий: **20 дней**
- Срок хранения еженедельных резервных копий: **10 недель**
- Срок хранения ежемесячных резервных копий: **1 год**

Работа системы резервного копирования задаётся в файле
_"/etc/btrbk.conf"_. Ключевые настройки для данного дистрибутива:
```
snapshot_dir            snapshots

snapshot_preserve_min   2d
snapshot_preserve       14d

target_preserve_min     no
target_preserve         20d 10w 1y

volume /mnt/btrfs
  snapshot_create  ondemand
  subvolume @home
    target send-receive /mnt/backup
```

## Планировщик
Периоднический запуск резервного копирования осущесвляется
слуюбой "btrbk.timer". Для её активации необходимо выполнить
команду:
```
systemctl enable btrbk.timer
```