# Защита системного раздела
Для обеспечения сохранности данных при аварийном выключении системы
корневая файловая система (/) и файловая система загрузчика (/boot)
монтируются в режиме только для чтения. Однако это требует внесения
дополнительных изменений в систему.

> [!NOTE]
> Данная конфигурация подразумевает, что домашняя директория (/home)
> допускает запись (например, смонтирована в отдельном разделе). Без
> этого не работает графическое окружение.

# Изменение системы журналирования
Запись системных журналов в системе с защищённым системным разделом
невозможна, поэтому устанавливается служба журналирования
"busybox-syslogd, не требующая записи на диск. Дополнительно 
устанавливается служба настройки времени через Интернет "ntp".

# Удаление заглушки часов
Поскольку сама плата Raspberry Pi не содержит часов (RTC),
в стандартный дистрибутив встроена заглушка (пакет "fake-hwclock"),
которая записывает текущее время при завершении работы в файл, а
при последующем включении считвает его обратно. При этом
предполагается, что время синхронизируется через Интернет. Данное
решение не работает, если нет возможности сохранить время в файл,
поэтому данный пакет удаляется.
```bash
apt remove -y --purge fake-hwclock
```

# Изменение параметров загрузки
Поскольку файл подкачки не может использоваться с носителями в
режиме доступа только на чтение, он отключается. Здесь же месте
укаывается режим доступа к корневой файловой системе - только
на чтение (ro). В файл "cmdline.txt" дописываются параметры:
```bash
noswap ro
```

#Перемещение файлов требующих записи
Некоторые системные файлы должны перезаписываться в процессе
работы ОС. Процедура их переноса заключается в перемещении
содержимого файлов в раздел "/tmp" с созданием ссылки в 
прежнем месте:
### resolv.conf
```bash
mv "/etc/resolv.conf" "/tmp/dhcpcd.resolv.conf"
ln -s "/tmp/dhcpcd.resolv.conf" "/etc/resolv.conf"
```

Пути к некоторым файлам прописаны в явном виде в файлах служб.
В таком случае дополнительно редактируется файл службы.
### random-seed
```bash
rm "/var/lib/systemd/random-seed"
ln -s "/tmp/random-seed" "/var/lib/systemd/random-seed"
install -m 644 files/systemd-random-seed.service "/lib/systemd/system/"
```

# Изменение таблицы разделов
В файл _"/etc/fstab"_ вносятся изменения для подключения
файловых системы "/boot" и "/" в режиме на чтение:
```
BOOTDEV  /boot  vfat    defaults,ro          0  2
ROOTDEV  /      ext4    defaults,ro,noatime  0  1
```
Также определённые каталоги монтируются в качестве
временной файловой системы:
```
tmpfs  /tmp              tmpfs  nosuid,nodev  0  0
tmpfs  /var/log          tmpfs  nosuid,nodev  0  0
tmpfs  /var/tmp          tmpfs  nosuid,nodev  0  0
tmpfs  /var/lib/dhcpcd5  tmpfs  nosuid,nodev  0  0
tmpfs  /var/lib/sudo/ts  tmpfs  nosuid,nodev  0  0
```
> [!IMPORTANT]
> Необходимо самостоятельно создать директорию _"/var/lib/sudo/ts"_.
> Без этого система с такой таблицей разделов не загрузится!

# Добавление команд переключения
В целях упрощения работы с системой в данной конфигурации
предусмотрено две дополнительные функции:

* Отображение текущего режима доступа к файловой системы
* Переключение между режимами с помощью команд "rw/ro".

Для работы этих функций в директорию _"/etc"_ помещается
файл "bash.bashrc" с соответствующим содержимым.